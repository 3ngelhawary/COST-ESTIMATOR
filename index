<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Consultant Design Cost Estimator (Demo)</title>
  <style>
    :root { --bg:#0b1020; --card:#121a33; --muted:#9fb0d0; --text:#e8eefc; --line:#243056; }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#070a14,var(--bg));color:var(--text);}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px;}
    h1{font-size:22px;margin:0 0 6px;}
    p{margin:0 0 16px;color:var(--muted);}
    .grid{display:grid;grid-template-columns:1.1fr 0.9fr;gap:16px;}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr;} }
    .card{background:rgba(18,26,51,.92);border:1px solid var(--line);border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;}
    @media (max-width: 620px){ .row{grid-template-columns:1fr;} }
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px;}
    input,select{width:100%;padding:10px 10px;border-radius:10px;border:1px solid #2b3a68;background:#0b1330;color:var(--text);outline:none;}
    input:focus,select:focus{border-color:#4f6bff;}
    .small{font-size:12px;color:var(--muted);}
    .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;}
    button{padding:10px 12px;border-radius:12px;border:1px solid #2b3a68;background:#17214a;color:var(--text);cursor:pointer;}
    button:hover{border-color:#4f6bff;}
    .kpi{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .kpi .box{border:1px solid var(--line);border-radius:12px;padding:12px;background:#0b1330;}
    .kpi .val{font-size:20px;font-weight:700;margin-top:4px;}
    .sep{height:1px;background:var(--line);margin:12px 0;}
    table{width:100%;border-collapse:collapse;font-size:13px;}
    th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left;}
    th{color:var(--muted);font-weight:600;}
    .note{border-left:3px solid #4f6bff;padding-left:10px;color:var(--muted);font-size:12px;line-height:1.4;}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--line);color:var(--muted);font-size:12px;}
    .footer{margin-top:12px;color:var(--muted);font-size:12px;}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Consultant Design Cost Estimator (Demo)</h1>
    <p>Prototype calculator to test your website flow. You’ll replace these assumptions with your detailed model later.</p>

    <div class="grid">
      <!-- INPUTS -->
      <div class="card">
        <div class="row">
          <div>
            <label>Project Name</label>
            <input id="projectName" placeholder="e.g., Pump Station MPS02" />
          </div>
          <div>
            <label>Currency</label>
            <select id="currency">
              <option value="SAR">SAR</option>
              <option value="EGP">EGP</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Project Type</label>
            <select id="projectType">
              <option value="pipeline">Pipeline / Linear Utilities</option>
              <option value="pump">Pump Station / Buildings</option>
              <option value="tanks">Reservoir / Tank</option>
              <option value="mixed">Mixed / Program</option>
            </select>
            <div class="small">Applies a type multiplier.</div>
          </div>
          <div>
            <label>Design Stage</label>
            <select id="stage">
              <option value="concept">Concept (10–15%)</option>
              <option value="schematic">Schematic (30%)</option>
              <option value="detailed">Detailed Design (60–90%)</option>
              <option value="ifc">IFC / Issued for Construction (100%)</option>
            </select>
            <div class="small">Applies a stage multiplier.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Complexity</label>
            <select id="complexity">
              <option value="low">Low (0.85×)</option>
              <option value="normal" selected>Normal (1.00×)</option>
              <option value="high">High (1.25×)</option>
              <option value="extreme">Extreme (1.50×)</option>
            </select>
          </div>
          <div>
            <label>Urgency</label>
            <select id="urgency">
              <option value="normal" selected>Normal (1.00×)</option>
              <option value="fast">Fast Track (1.15×)</option>
              <option value="crash">Crash / Weekend (1.30×)</option>
            </select>
          </div>
        </div>

        <div class="sep"></div>

        <div class="row">
          <div>
            <label>Base Design Fee (lump sum)</label>
            <input id="baseFee" type="number" min="0" step="1000" value="200000" />
            <div class="small">A starting point before multipliers. Replace later with your rules.</div>
          </div>
          <div>
            <label>Direct Expenses (travel / prints / etc.)</label>
            <input id="directExpenses" type="number" min="0" step="100" value="5000" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>Overhead (%)</label>
            <input id="overheadPct" type="number" min="0" step="0.5" value="15" />
          </div>
          <div>
            <label>Profit (%)</label>
            <input id="profitPct" type="number" min="0" step="0.5" value="10" />
          </div>
        </div>

        <div class="sep"></div>
        <div class="pill">Optional: bottom-up hours</div>
        <div class="row" style="margin-top:10px;">
          <div>
            <label>PM Rate / hr</label>
            <input id="pmRate" type="number" min="0" step="10" value="450" />
          </div>
          <div>
            <label>PM Hours</label>
            <input id="pmHours" type="number" min="0" step="1" value="20" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Lead Engineer Rate / hr</label>
            <input id="leadRate" type="number" min="0" step="10" value="350" />
          </div>
          <div>
            <label>Lead Engineer Hours</label>
            <input id="leadHours" type="number" min="0" step="1" value="60" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>BIM/Modeler Rate / hr</label>
            <input id="bimRate" type="number" min="0" step="10" value="220" />
          </div>
          <div>
            <label>BIM/Modeler Hours</label>
            <input id="bimHours" type="number" min="0" step="1" value="80" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>CAD/Drafter Rate / hr</label>
            <input id="cadRate" type="number" min="0" step="10" value="160" />
          </div>
          <div>
            <label>CAD/Drafter Hours</label>
            <input id="cadHours" type="number" min="0" step="1" value="120" />
          </div>
        </div>

        <div class="btns">
          <button id="calcBtn">Calculate</button>
          <button id="resetBtn">Reset</button>
          <button id="shareBtn">Copy Share Link</button>
          <button id="printBtn">Print / Save PDF</button>
        </div>

        <div class="footer note">
          Later you can add: disciplines breakdown (Civil/Structural/MEP), BIM LOD, number of packages, client review cycles, QA/QC %, site visits count, deliverables list, assumptions text, and an export to Excel/Word/PDF.
        </div>
      </div>

      <!-- OUTPUTS -->
      <div class="card">
        <div class="kpi">
          <div class="box">
            <div class="small">Estimated Total</div>
            <div id="totalOut" class="val">—</div>
            <div id="metaOut" class="small">—</div>
          </div>
          <div class="box">
            <div class="small">Design Fee (before OH/Profit)</div>
            <div id="designFeeOut" class="val">—</div>
            <div class="small">Includes multipliers + optional hours uplift</div>
          </div>
        </div>

        <div class="sep"></div>

        <table>
          <thead>
            <tr><th>Component</th><th>Amount</th></tr>
          </thead>
          <tbody id="breakdownBody">
            <tr><td>—</td><td>—</td></tr>
          </tbody>
        </table>

        <div class="sep"></div>
        <div class="small">Assumptions (demo)</div>
        <div id="assumptions" class="footer mono"></div>
      </div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  const multipliers = {
    projectType: { pipeline: 1.00, pump: 1.20, tanks: 1.10, mixed: 1.30 },
    stage: { concept: 0.25, schematic: 0.45, detailed: 0.85, ifc: 1.00 },
    complexity: { low: 0.85, normal: 1.00, high: 1.25, extreme: 1.50 },
    urgency: { normal: 1.00, fast: 1.15, crash: 1.30 }
  };

  function fmt(n, cur){
    const num = Number(n || 0);
    return new Intl.NumberFormat(undefined, { maximumFractionDigits: 0 }).format(num) + " " + cur;
  }

  function readNumber(id){
    const v = Number($(id).value);
    return Number.isFinite(v) ? v : 0;
  }

  function getState(){
    return {
      projectName: $("projectName").value || "",
      currency: $("currency").value,
      projectType: $("projectType").value,
      stage: $("stage").value,
      complexity: $("complexity").value,
      urgency: $("urgency").value,
      baseFee: readNumber("baseFee"),
      directExpenses: readNumber("directExpenses"),
      overheadPct: readNumber("overheadPct"),
      profitPct: readNumber("profitPct"),
      pmRate: readNumber("pmRate"),
      pmHours: readNumber("pmHours"),
      leadRate: readNumber("leadRate"),
      leadHours: readNumber("leadHours"),
      bimRate: readNumber("bimRate"),
      bimHours: readNumber("bimHours"),
      cadRate: readNumber("cadRate"),
      cadHours: readNumber("cadHours"),
    };
  }

  function setState(s){
    if (!s) return;
    for (const k of Object.keys(s)){
      if ($(k)) $(k).value = s[k];
    }
  }

  function calc(){
    const s = getState();
    const cur = s.currency;

    const mType = multipliers.projectType[s.projectType] ?? 1;
    const mStage = multipliers.stage[s.stage] ?? 1;
    const mComp = multipliers.complexity[s.complexity] ?? 1;
    const mUrg = multipliers.urgency[s.urgency] ?? 1;

    const feeWithMultipliers = s.baseFee * mType * mStage * mComp * mUrg;

    // bottom-up hours (optional). We treat it as a "floor": if hours cost > multiplier cost, use the higher one.
    const hoursCost =
      (s.pmRate * s.pmHours) +
      (s.leadRate * s.leadHours) +
      (s.bimRate * s.bimHours) +
      (s.cadRate * s.cadHours);

    const designFee = Math.max(feeWithMultipliers, hoursCost);

    const overhead = designFee * (s.overheadPct / 100);
    const profit = (designFee + overhead) * (s.profitPct / 100);
    const subtotal = designFee + overhead + profit;
    const total = subtotal + s.directExpenses;

    $("designFeeOut").textContent = fmt(designFee, cur);
    $("totalOut").textContent = fmt(total, cur);
    $("metaOut").textContent =
      (s.projectName ? s.projectName + " • " : "") +
      `Type ${mType.toFixed(2)}× • Stage ${mStage.toFixed(2)}× • Complexity ${mComp.toFixed(2)}× • Urgency ${mUrg.toFixed(2)}×`;

    const rows = [
      ["Base Fee", fmt(s.baseFee, cur)],
      ["Fee after multipliers", fmt(feeWithMultipliers, cur)],
      ["Bottom-up hours cost (optional floor)", fmt(hoursCost, cur)],
      ["Design fee used", fmt(designFee, cur)],
      [`Overhead (${s.overheadPct}%)`, fmt(overhead, cur)],
      [`Profit (${s.profitPct}%)`, fmt(profit, cur)],
      ["Direct expenses", fmt(s.directExpenses, cur)],
      ["TOTAL", fmt(total, cur)]
    ];

    const body = $("breakdownBody");
    body.innerHTML = rows.map(r => `<tr><td>${r[0]}</td><td>${r[1]}</td></tr>`).join("");

    $("assumptions").textContent =
      `ProjectType=${s.projectType} (x${mType})\n` +
      `Stage=${s.stage} (x${mStage})\n` +
      `Complexity=${s.complexity} (x${mComp})\n` +
      `Urgency=${s.urgency} (x${mUrg})\n` +
      `DesignFee = max(BaseFee*Multipliers, HoursCost)\n` +
      `Overhead = DesignFee*${s.overheadPct}%\n` +
      `Profit = (DesignFee+Overhead)*${s.profitPct}%\n` +
      `Total = DesignFee+Overhead+Profit+DirectExpenses`;

    // Keep URL updated so it's sharable
    writeToUrl(s);
  }

  function resetAll(){
    const defaults = {
      projectName: "",
      currency: "SAR",
      projectType: "pipeline",
      stage: "concept",
      complexity: "normal",
      urgency: "normal",
      baseFee: 200000,
      directExpenses: 5000,
      overheadPct: 15,
      profitPct: 10,
      pmRate: 450, pmHours: 20,
      leadRate: 350, leadHours: 60,
      bimRate: 220, bimHours: 80,
      cadRate: 160, cadHours: 120
    };
    setState(defaults);
    calc();
  }

  function writeToUrl(state){
    const params = new URLSearchParams();
    for (const [k,v] of Object.entries(state)){
      params.set(k, String(v));
    }
    const newUrl = location.pathname + "?" + params.toString();
    history.replaceState(null, "", newUrl);
  }

  function readFromUrl(){
    const params = new URLSearchParams(location.search);
    if ([...params.keys()].length === 0) return null;
    const s = {};
    for (const [k,v] of params.entries()){
      // numbers
      if (["baseFee","directExpenses","overheadPct","profitPct","pmRate","pmHours","leadRate","leadHours","bimRate","bimHours","cadRate","cadHours"].includes(k)){
        s[k] = Number(v);
      } else {
        s[k] = v;
      }
    }
    return s;
  }

  async function copyShareLink(){
    const url = location.href;
    try{
      await navigator.clipboard.writeText(url);
      alert("Share link copied!");
    }catch{
      prompt("Copy this link:", url);
    }
  }

  // events
  $("calcBtn").addEventListener("click", calc);
  $("resetBtn").addEventListener("click", resetAll);
  $("shareBtn").addEventListener("click", copyShareLink);
  $("printBtn").addEventListener("click", () => window.print());

  // auto-calc on input change (nice for testing)
  document.addEventListener("input", (e) => {
    const tag = e.target.tagName.toLowerCase();
    if (tag === "input" || tag === "select") calc();
  });

  // init
  const fromUrl = readFromUrl();
  if (fromUrl) setState(fromUrl);
  calc();
</script>
</body>
</html>
